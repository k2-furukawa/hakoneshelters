<html>
<head> 
<title>Shelters in Hakone City</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=yes" charset="utf-8" /> 
<link rel="stylesheet" href="jqwidgets/styles/jqx.base.css" type="text/css" />
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="jqwidgets/jqxcore.js"></script>
<script type="text/javascript" src="jqwidgets/jqxdata.js"></script> 
<link class="include" rel="stylesheet" type="text/css" href="jqplot/jquery.jqplot.min.css" />
<script class="include" type="text/javascript" src="jqplot/jquery.jqplot.min.js"></script>
<script type="text/javascript" src="jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&v=3&language=ja&libraries=visualization"></script> 
<script type="text/javascript" src="jquery.xdomainajax.js"></script>
<script type="text/javascript"> 
  function initialize() { 
  
    String.prototype.replaceAll = function (org, dest){  
      return this.split(org).join(dest);  
    }  

    // Put shelters on Google Maps
    var mapstyle = [
    {
　    featureType:"all",
　    elementType:"all",
　    stylers: [
        {visibility: "on" }
      ]
    }
    ]; 
    var latlng = new google.maps.LatLng(35.242364, 139.020882); // Ohwakudani
    var myOptions = { 
      zoom: 12, 
      center: latlng, 
      mapTypeId: google.maps.MapTypeId.ROADMAP 
    }; 
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);  
    // Alert point 'Ohwakudani'
    new google.maps.Circle({
      center: latlng,
      fillColor: '#ff0000',
      fillOpacity: 0.20,
      map: map,
      radius: 300,
      strokeColor: '#ff0000',
      strokeOpacity: 0,
      strokeWeight: 1
    }); 
    new google.maps.Circle({
      center: latlng,
      fillColor: '#ff0000',
      fillOpacity: 0.10,
      map: map,
      radius: 1000,
      strokeColor: '#ff0000',
      strokeOpacity: 0,
      strokeWeight: 1
    }); 
    
    //binding shelters.csv
    var url = './shelters.csv';
    var source = {
        datatype: "csv",
        datafields: [
          { name: 'id', type: 'float' },
          { name: 'area', type: 'text' },
          { name: 'district', type: 'text' },
          { name: 'shelter', type: 'text' },
          { name: 'address', type: 'text' },
          { name: 'lat', type: 'float' },
          { name: 'lng', type: 'float' },
          { name: 'route', type: 'text' }],
          url: url
        };
    var dataAdapter = new $.jqx.dataAdapter(source, {
        loadComplete: function () {
          var records = dataAdapter.records;
          var length = records.length;
          for ( var i = 0 ; i < length ; i++) {
              var pos = new google.maps.LatLng(records[i].lat, records[i].lng);
              var marker = new google.maps.Marker({
                position: pos,
                map: map, 
                title: records[i].shelter
              });

          }
        }
    
    });
    dataAdapter.dataBind();
    
    // Occurrence times of Earthquake
    var content = new Array();
    $.ajax({
      url: 'http://www.onken.odawara.kanagawa.jp/files/dat_auto/list_N_day.html',
      type: 'GET',
      cache: false,
      async: false,
      success: function(res) {
        var tags = $(res.responseText).find("LI").children().prevObject.prevObject;
        for( var i=0; i < tags.length ; i++ ) {
          if( tags[i].nodeName == 'LI' ) content.push(tags[i].innerText.split('\n')[0] );
        }
        
        var data = [];
//        for( var i=0 ; i < content.length ; i++ ) {
        for( var i=30 ; i >= 0 ; i-- ) {
          var d = content[i].split("　　");
//          data.push( [parseInt(d[1]), Date.parse(d[0])] );
          data.push( [ d[0].replaceAll('/', '-'), parseInt(d[1])] );
        }
        jQuery.jqplot(
            'earthquake',
             [data],
            {
                title: '箱根 地震発生回数 (回/日)',
                axes:{
                    xaxis:{
                        label:'date',
                        renderer:$.jqplot.DateAxisRenderer,
                        series:[{lineWidth:4, markerOptions:{style:'square'}}]
                    },
                    yaxis:{
                        label:'times',
                        min: 0
                    }
               }
            }
        );
      }
    })
  }
</script> 
</head> 
<body onload="initialize()"> 
  <p align="left">箱根町避難所マップ Shelters in Hakone City<img src="resources/cfk.jpg" align=right widrh=100px height=40px></p>
  
  <div id="map_canvas" style="float:left;width:100%; height:80%;"></div> 
  <p>神奈川県公式 <a href="http://www.pref.kanagawa.jp/cnt/f532566/">箱根大涌谷情報</a></p>
  <p>箱根町公式 <a href="http://www.town.hakone.kanagawa.jp/hakone_j/ka/soumu/saigai02.html">箱根町周辺の火山・地震活動</a></p>

  <a href="https://www.facebook.com/kanagawa.hakone">箱根・大涌谷情報 Facebook Pageフィード</a>
<!-- start feedwind code --><script type="text/javascript">document.write('\x3Cscript type="text/javascript" src="' + ('https:' == document.location.protocol ? 'https://' : 'http://') + 'feed.mikle.com/js/rssmikle.js">\x3C/script>');</script><script type="text/javascript">(function() {var params = {rssmikle_url: "http://ja-jp.facebook.com/feeds/page.php?id=684661398305733&format=rss20|https://www.facebook.com/feeds/page.php?id=684640111641195&format=rss20",rssmikle_frame_width: "100%",rssmikle_frame_height: "300",frame_height_by_article: "3",rssmikle_target: "_blank",rssmikle_font: "'メイリオ','ＭＳ Ｐゴシック',sans-serif",rssmikle_font_size: "12",rssmikle_border: "on",responsive: "off",rssmikle_css_url: "",text_align: "left",text_align2: "left",corner: "off",scrollbar: "on",autoscroll: "on",scrolldirection: "up",scrollstep: "3",mcspeed: "20",sort: "Off",rssmikle_title: "on",rssmikle_title_sentence: "",rssmikle_title_link: "https://www.facebook.com/kanagawa.hakone",rssmikle_title_bgcolor: "#9ACD32",rssmikle_title_color: "#FFFFFF",rssmikle_title_bgimage: "",rssmikle_item_bgcolor: "#FFFFFF",rssmikle_item_bgimage: "",rssmikle_item_title_length: "55",rssmikle_item_title_color: "#666666",rssmikle_item_border_bottom: "on",rssmikle_item_description: "on",item_link: "off",rssmikle_item_description_length: "150",rssmikle_item_description_color: "#666666",rssmikle_item_date: "ja",rssmikle_timezone: "Etc/GMT",datetime_format: "",item_description_style: "text+tn",item_thumbnail: "full",item_thumbnail_selection: "auto",article_num: "15",rssmikle_item_podcast: "off",keyword_inc: "",keyword_exc: ""};feedwind_show_widget_iframe(params);})();</script><div style="font-size:10px; text-align:center; width: '100%';"><a href="http://feed.mikle.com/" target="_blank" style="color:#CCCCCC;">RSS Feed Widget</a><!--Please display the above link in your web page according to Terms of Service.--></div><!-- end feedwind code -->

  <a href="http://www.onken.odawara.kanagawa.jp/files/dat_auto/list_N_day.html">箱根で発生した１日ごとの地震数</a>
  <div id="earthquake" style="height: 300pt; width: 100%;"></div>

</body> 
</html>